<!DOCTYPE html>
<html>
    <head>
        <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
        body{
        font-family: 'Poppins', sans-serif;
        background-color: #FFE6E6;
        }
        .content-box{
        width: 30vw;
        height: 60vh;
        border-radius: 2em;
        box-shadow: 0 0 2em rgba(0, 0, 0, .2);
        }
        </style>
    </head>
    <body>
        <center>
        <img src = "/images/rooMeclear.png" class = "logo" width = "30%" style="margin-top: -5%; margin-left:4%;">
        <div class = "content-box" style="margin-top: -12%;">
            <div class = "content-second-box" style = "padding-top: 25%;">
                <label for="email">Email</label><br>
                <input type="email" id="email" required> <br>
                <label for="password">Password</label><br>
                <input type="password" id="password" required> <br>
                <button type="button"  id="logIn">Log in!</button><br> <br>
                <button type="button"  id="googleLogIn">Login with Google!</button><br> <br>
                <button type="button"  id="forgotPassword"> Forgot password? </button><br> <br>   
                <a href="SignUp.html"><p> Create an account here!</p></a>
            </div>
        </div>
    </center>
    </body>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
        import { getDatabase, update, set, ref } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-auth.js";
    
        const firebaseConfig = {
          apiKey: "",
          authDomain: "",
          databaseURL: "",
          projectId: "",
          storageBucket: "",
          messagingSenderId: "",
          appId: ""
        };
  
   
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db =  getDatabase(app);
        const provider = new GoogleAuthProvider(app);

        logIn.addEventListener('click', function (e) {

            var email = document.getElementById("email").value;
            var password = document.getElementById("password").value;
            
            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // Signed in 
                    var user = userCredential.user;
                    const dt = new Date();
                    update(ref(db, "Users/"+ user.uid),{
                        last_login: dt,
                    })
                    .then(()=>{
                        alert(`Logged in with ${email}`);
                        window.location.replace("ViewProfile.html");
                    })
                    .catch((error)=>{
                        alert(error);
                    });
                    
                })
                .catch((error) => {
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    // ..
                    alert(errorMessage)
                });
            
        });

        googleLogIn.addEventListener("click", function(e) {
            signInWithPopup(auth, provider)
            .then((result) => {
                // This gives you a Google Access Token. You can use it to access the Google API.
                const credential = GoogleAuthProvider.credentialFromResult(result);
                const token = credential.accessToken;
                // The signed-in user info.
                const user = result.user;

                const dt = new Date();
                update(ref(db, "Users/"+ user.uid),{
                    last_login: dt,
                })
                .then(()=>{
                    alert(`Logged in with ${user.email}`);
                    window.location.replace("ViewProfile.html");
                })
                .catch((error)=>{
                    alert(error);
                });

            }).catch((error) => {
                // Handle Errors here.
                const errorCode = error.code;
                const errorMessage = error.message;
                // The email of the user's account used.
                const email = error.email;
                // The AuthCredential type that was used.
                const credential = GoogleAuthProvider.credentialFromError(error);

                alert(errorMessage);
            });

        });
        
        forgotPassword.addEventListener("click", function(e) {
                var email = document.getElementById("email").value;

                sendPasswordResetEmail(auth, email)
                .then(() => {

                    alert(`Sent password reset link to ${email}`)
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    
                });


            });

      </script>
</html>
