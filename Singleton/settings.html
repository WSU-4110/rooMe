<!DOCTYPE html>

<html>
<head>
    <link  rel="stylesheet" type = "text/css" href="/css/style.css">
    <title>RooMe Settings</title>
</head>


<body>
    <center>
        <img src = "/images/rooMeclear.png" class = "logo" width = "30%">
    </center>
    <div class="action">
        <div class="menu">
<h3> Settings</h3>

    <ul>
        <li><img src="/images/Home.png"><a href="ViewProfile.html">Home</a></li>
        <li><img src="/images/edit.png"><a href="editProfile.html">Edit Profile</a></li>
        <li><img src="/images/notification.png"><a href="#">Notifications</a></li>
        <li><img src="/images/privacy.png"><a href="#">Privacy and Security</a></li>
        <li><img src="/images/logout.png"><a href="#" id="signingOut">Logout</a></li>
        <li><img src="/images/delete.png"><a href="#" id="deleteAccount">Delete Account</a></li>
    </ul>

</div>

<div id="page" class="site">
    <div class="container">
        <nav> 
            <ul>
                <li class="active"><a href="../pages/ViewProfile.html"><span>Home</span><img src="favicon.png"></i></a> </li>
                <li><a href="../pages/Chat.html" >
                    <span>Chat Page</span>
                    <i class="ri-wechat-line"></i>
                    <span class="label chat">1 </span>
                </a> </li>
                <li><a href="../houselistings/listing houses.html" ><span>Listing page</span><i class="ri-file-list-3-line"></i></a> </li>
                <li><a href="../pages/settings.html" ><span>Settings</span><i class="ri-settings-2-line"></i> </a> </li>
            </ul>
        </nav>
    </div>
</div>

    </body>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
        import { getDatabase, update, set, ref, remove } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-database.js";
        import { getAuth, signOut, deleteUser } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-auth.js";
    
        const firebaseConfig = {
          apiKey: "AIzaSyClqbgmtcPuED7LE3-2XXSooypjXiHQj38",
          authDomain: "roome-5bfa9.firebaseapp.com",
          databaseURL: "https://roome-5bfa9-default-rtdb.firebaseio.com",
          projectId: "roome-5bfa9",
          storageBucket: "roome-5bfa9.appspot.com",
          messagingSenderId: "564378590257",
          appId: "1:564378590257:web:6e18a1d7269d83af318910"
        };
  
   
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db =  getDatabase(app);

        signingOut.addEventListener('click', function (e) {
            const user = auth.currentUser;
            signOut(auth).then(() => {
                const dt = new Date();
                update(ref(db, "Users/"+ user.uid),{
                    last_logout: dt,
                })
                .then(()=>{
                    alert("Logged Out!");
                    window.location.replace("LandingPage.html");
                })
                .catch((error)=>{
                    alert(error);
                });
            }).catch((error) => {
            // An error happened.
            const errorMessage = error.message;
            alert(errorMessage);
            });
        });

        deleteAccount.addEventListener('click', function (e) {
            const user = auth.currentUser;
            if(confirm("Are you sure you want to delete the account?")){
                deleteUser(user).then(() => {
                    remove(ref(db, "Users/"+ user.uid)).then(()=>{
                        alert("We will miss you!");
                        window.location.replace("LandingPage.html");
                    }) .catch((error)=>{
                        alert(error);
                    });
                }).catch((error) => {
                // An error ocurred
                const errorMessage = error.message;
                alert(errorMessage);
                });
            }
        });

      </script>
    </html>